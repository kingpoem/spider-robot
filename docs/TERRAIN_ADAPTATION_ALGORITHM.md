# 地形自适应算法说明

## 算法概述

本项目使用的地形自适应算法是一种**基于点云统计特征的地形评估方法**，用于分析机器人周围的地形特征，并计算适应性评分。

## 算法特点

该算法不是标准的学术算法名称，而是一种**自定义的多特征融合地形评估方法**，结合了以下分析维度：

1. **坡度分析** (Slope Analysis)
2. **粗糙度分析** (Roughness Analysis)
3. **可达性分析** (Reachability Analysis)
4. **安全性评分** (Safety Score)

## 算法实现

### 1. 坡度分析 (analyzeSlope)

**方法**：基于点云的高度差异计算坡度

**步骤**：
1. 计算点云的中心点坐标
2. 找到点云中的最大和最小Z值（高度）
3. 计算高度差与分析半径的比值
4. 归一化到[0, 1]范围

**公式**：
```
slope = min(1.0, height_diff / analysis_radius)
```

**意义**：
- 值越大表示坡度越大
- 用于判断地形是否陡峭

### 2. 粗糙度分析 (analyzeRoughness)

**方法**：基于点云的标准差计算粗糙度

**步骤**：
1. 计算点云的中心点
2. 计算每个点到中心点的距离方差
3. 计算标准差
4. 归一化到[0, 1]范围

**公式**：
```
variance = mean((point - center)²)
roughness = min(1.0, std_dev / 0.1)
```

**意义**：
- 值越大表示地形越粗糙
- 用于判断地形的平整程度

### 3. 可达性分析 (analyzeReachability)

**方法**：基于点云密度计算可达性

**步骤**：
1. 计算点云中点的数量
2. 计算点云密度（点数/分析区域面积）
3. 归一化到[0, 1]范围

**公式**：
```
density = point_count / (analysis_radius² * π)
reachability = min(1.0, density / 100.0)
```

**意义**：
- 值越大表示点云密度越高
- 用于判断机器人是否能够到达该区域

### 4. 安全性评分 (calculateSafety)

**方法**：综合坡度、粗糙度和可达性计算安全性

**公式**：
```
safety = 1.0 - (slope * 0.4 + roughness * 0.6)
safety = clamp(safety, 0.0, 1.0)
```

**权重说明**：
- 坡度权重：0.4
- 粗糙度权重：0.6
- 可达性不直接参与安全性计算，但影响整体评估

**意义**：
- 值越大表示地形越安全
- 用于决策是否选择该路径

## 算法参数

### 分析参数

- `analysis_radius_`: 0.5米 - 分析半径
- `min_points_`: 10 - 最小点数阈值

### 归一化参数

- 坡度归一化：除以分析半径
- 粗糙度归一化：除以0.1米
- 可达性归一化：除以100点/平方米

## 算法流程

```
输入：点云数据 (PointCloud2)
  ↓
1. 提取点云中的3D点
  ↓
2. 坡度分析 → slope
  ↓
3. 粗糙度分析 → roughness
  ↓
4. 可达性分析 → reachability
  ↓
5. 安全性计算 → safety
  ↓
输出：TerrainScore {slope, roughness, reachability, safety}
```

## 使用场景

该算法适用于：
- 复杂地形导航
- 路径规划
- 步态参数调整
- 障碍物避让

## 算法优势

1. **实时性**：计算简单，适合实时应用
2. **多维度**：综合考虑多个地形特征
3. **可调参数**：可以根据实际需求调整权重和阈值
4. **鲁棒性**：对点云噪声有一定的容忍度

## 算法局限性

1. **简化模型**：使用统计特征，可能丢失细节信息
2. **参数依赖**：需要根据实际地形调整参数
3. **点云质量**：依赖点云的质量和密度

## 改进方向

1. 引入机器学习方法进行地形分类
2. 使用更复杂的特征提取方法
3. 结合历史数据进行学习优化
4. 增加动态障碍物检测

## 相关代码位置

- 头文件：`ros2/hexapod_gait_planner/src/terrain_adaptation.hpp`
- 实现文件：`ros2/hexapod_gait_planner/src/terrain_adaptation.cpp`

## 参考文献

该算法基于以下思想：
- 点云处理基础方法
- 地形特征提取技术
- 多特征融合评估方法

